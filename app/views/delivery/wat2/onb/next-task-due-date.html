{% extends "layouts/main.html" %}
{% set pageName="Task due date" %}

{% block header %}
{% include "/delivery/wat2/partials/header/none-selected.html" %}
{% endblock %}

{% block beforeContent %}
{% include "/delivery/wat2/partials/identity-bar/index.html" %}
<a href="javascript:window.history.back()" class="govuk-back-link">Back</a>
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">

        <h1 class="govuk-heading-l">When is the task to {{ data['nextTask'] | lower }} due?</h1>

        <form action="/delivery/wat2/onb/next-task-due-date-answer" method="post">
            
            <div class="govuk-form-group">
                <label class="govuk-label govuk-label--m govuk-visually-hidden" for="task-due-date">
                    Due date
                </label>

                <div class="govuk-hint" id="task-due-date-hint">
                    If you need to change the date, use the date picker or enter a date. For example, 17/05/2025
                </div>

                <div class="moj-datepicker" id="task-due-date-picker" data-module="moj-date-picker" data-excluded-days="saturday sunday">
                    <input type="text" class="govuk-input moj-js-datepicker-input" id="task-due-date"
                        name="taskDueDate"
                        autocomplete="off"
                        aria-describedby="task-due-date-hint"
                        value="{{ data['taskDueDate'] }}" />
                </div>
            </div>

            <button class="govuk-button" data-module="govuk-button">
                Save and continue
            </button>
        </form>
    </div>
</div>

<script>
    // Calculate today + 5 working days on page load
    document.addEventListener('DOMContentLoaded', function() {
        var inputField = document.getElementById('task-due-date');
        
        // Only set default if no value is already present
        if (!inputField.value) {
            var targetDate = calculateWorkingDaysAhead(5);
            inputField.value = formatDateForInput(targetDate);
        }
    });

    function calculateWorkingDaysAhead(days) {
        var date = new Date();
        var count = 0;

        while (count < days) {
            date.setDate(date.getDate() + 1);
            var dayOfWeek = date.getDay();
            // 0 = Sunday, 6 = Saturday
            if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                count++;
            }
        }

        return date;
    }

    function formatDateForInput(date) {
        var day = String(date.getDate()).padStart(2, '0');
        var month = String(date.getMonth() + 1).padStart(2, '0');
        var year = date.getFullYear();
        return day + '/' + month + '/' + year;
    }
</script>
{% endblock %}
